<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘èåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆæˆ¦ç•¥åˆ†æè¿½åŠ ï¼‰</title>
    <!-- Tailwind CSS CDN (v3.4.1) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN (v4.4.1) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- Noto Sans JP Font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+JP:wght@100..900&display=swap');
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-8 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-3 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            é‡‘èåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆæˆ¦ç•¥åˆ†æè¿½åŠ ï¼‰
        </h1>

        <!-- ä¸»è¦é‡‘èãƒ¡ãƒˆãƒªã‚¯ã‚¹ & æµå‹•æ€§åˆ†æ -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
            <!-- ç´”è³‡ç”£ (Net Worth) -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-b-4 border-green-500">
                <p class="text-sm font-medium text-gray-500">ç´”è³‡ç”£ï¼ˆNet Worthï¼‰</p>
                <p id="net-worth-gold" class="text-2xl font-bold text-gray-900 mt-1"></p>
            </div>
            <!-- æµå‹•è³‡ç”£ (Liquid Assets) -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-b-4 border-indigo-500">
                <p class="text-sm font-medium text-gray-500">æµå‹•è³‡ç”£ï¼ˆLiquid Assetsï¼‰</p>
                <p id="liquid-assets-gold" class="text-2xl font-bold text-gray-900 mt-1"></p>
            </div>
            <!-- åˆæœŸæŠ•è³‡ROI -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-b-4 border-red-500">
                <p class="text-sm font-medium text-gray-500">åˆæœŸæŠ•è³‡ROI</p>
                <p id="overall-roi" class="text-2xl font-bold text-red-600 mt-1">âˆ %</p>
            </div>
            <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³ROI -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-b-4 border-pink-500">
                <p class="text-sm font-medium text-gray-500">ã‚»ãƒƒã‚·ãƒ§ãƒ³ROI</p>
                <p id="current-roi" class="text-2xl font-bold text-gray-900 mt-1"></p>
            </div>
             <!-- NEW: æ¶ˆè²»ç¶­æŒæ—¥æ•° -->
             <div class="bg-white p-6 rounded-xl shadow-lg border-b-4 border-yellow-500">
                <p class="text-sm font-medium text-gray-500">ç”Ÿæ´»ç¶­æŒæ—¥æ•°ï¼ˆCash Bufferï¼‰</p>
                <p id="consumption-days" class="text-2xl font-bold text-gray-900 mt-1"></p>
            </div>
        </div>

        <!-- ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã¨åç›Šæ€§åˆ†æ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒ»ã‚¢ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ğŸ“Š ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒ»ã‚¢ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³</h2>
                <div class="h-64 flex justify-center items-center">
                    <canvas id="assetBreakdownChart"></canvas>
                </div>
                <div id="asset-breakdown-details" class="mt-4 text-sm text-gray-600"></div>
            </div>

            <!-- åç›Šæ€§åˆ†æ / ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ -->
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ğŸ“ˆ åç›Šæ€§åˆ†æ (ãƒãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼)</h2>
                <div class="h-80">
                    <canvas id="cashFlowChart"></canvas>
                </div>
                <!-- ROIè©³ç´° -->
                <div class="mt-6 p-3 bg-yellow-50 rounded-lg text-sm">
                    <p class="font-bold text-yellow-800">ROIã«é–¢ã™ã‚‹ç‰¹è¨˜äº‹é …</p>
                    <p class="text-gray-700">åˆã‚¯ã‚¨ã‚¹ãƒˆã®ROIã¯åˆæœŸæŠ•è³‡ã‚¼ãƒ­ã®ãŸã‚ **ç„¡é™å¤§%** ã§ã™ã€‚å®¶å…·è³¼å…¥ã®æ”¯å‡ºã¯æŠ•è³‡ã§ã¯ãªãç”Ÿæ´»ã®è³ªå‘ä¸Šï¼ˆãƒªã‚¢ãƒ»ã‚»ãƒ©ã¨ã®çµ†æ·±åŒ–ğŸ’•ï¼‰ã®ãŸã‚ã®è²»ç”¨ã¨è¦‹ãªã•ã‚Œã¾ã™ã€‚</p>
                </div>
            </div>
        </div>
        
        <!-- NEW: æˆ¦ç•¥çš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¨ç›®æ¨™é€²æ— -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- ç›®æ¨™é”æˆé€²æ— -->
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ğŸš€ ç›®æ¨™é”æˆé€²æ— (Milestone 1: 5 Gold)</h2>
                <div class="h-64 p-4 flex flex-col justify-center">
                    <canvas id="targetProgressChart"></canvas>
                </div>
                <p id="milestone-note" class="text-sm text-gray-600 mt-4"></p>
            </div>
             <!-- æˆ¦ç•¥çš„æ”¯å‡ºã®è©•ä¾¡ -->
             <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">âš”ï¸ æˆ¦ç•¥çš„æ”¯å‡ºã®è©•ä¾¡</h2>
                <p class="text-sm text-gray-700">
                    ç¾åœ¨ã®è£…å‚™ã¯ä½ä¾¡å€¤ï¼ˆ7.4%ï¼‰ãªæœ¨å‰£ã®ã¿ã§ã™ã€‚ã“ã‚Œã¯ã€ä»Šå¾Œã®ã‚¯ã‚¨ã‚¹ãƒˆæˆåŠŸç‡ï¼ˆå°†æ¥ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ï¼‰ã«å¯¾ã™ã‚‹ãƒªã‚¹ã‚¯è¦å› ã¨ãªã‚Šã¾ã™ã€‚
                </p>
                <div class="mt-4 p-3 bg-red-50 rounded-lg text-sm border border-red-200">
                    <p class="font-bold text-red-700">ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼šæ—©æœŸã®è£…å‚™æŠ•è³‡</p>
                    <p class="text-gray-600">
                        å®Ÿæˆ¦ç”¨ã®å‰£ï¼ˆ0.1 Gold/æœ¬ï¼‰ã‚’æœ€ä½1ã€œ2æœ¬è³¼å…¥ã—ã€æˆ¦é—˜åŠ¹ç‡ã‚’é«˜ã‚ã‚‹ã“ã¨ã§ã€æ¬¡ã®ã‚¯ã‚¨ã‚¹ãƒˆå ±é…¬ã‚’ç¢ºå®Ÿãªã‚‚ã®ã«ã™ã‚‹ã€Œæˆ¦ç•¥çš„æ”¯å‡ºã€ã‚’æ¨å¥¨ã—ã¾ã™ã€‚
                    </p>
                </div>
            </div>
        </div>

        <!-- å°†æ¥ã®æŠ•è³‡æ©Ÿä¼šã¨æµå‹•æ€§åˆ†æ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
             <!-- æŠ•è³‡æ©Ÿä¼šåˆ†æ (ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³) -->
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ğŸ¯ å°†æ¥ã®æŠ•è³‡æ©Ÿä¼šåˆ†æ (ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æŠ•è³‡å¯¾è±¡</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å¿…è¦è³‡é‡‘ (é‡‘è²¨)</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å¹´é–“åç›Š (é‡‘è²¨)</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æƒ³å®šROI</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å‚™è€ƒ</th>
                            </tr>
                        </thead>
                        <tbody id="investment-simulation-body" class="bg-white divide-y divide-gray-200">
                             <!-- æŠ•è³‡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã‚‹ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- æµå‹•æ€§åˆ†æ (è³¼è²·åŠ›) -->
            <div class="lg:col-span-1 grid grid-cols-1 gap-6">
                <!-- è³¼è²·åŠ› -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ğŸ’° æµå‹•æ€§åˆ†æ (è³¼è²·åŠ›)</h2>
                    <ul id="purchasing-power-list" class="space-y-2 text-sm">
                        <!-- è³¼è²·åŠ›ãƒªã‚¹ãƒˆãŒå…¥ã‚‹ -->
                    </ul>
                </div>
            </div>
        </div>

        <!-- å–å¼•å±¥æ­´ã¨è³‡ç”£è©³ç´° -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
             <!-- å–å¼•å±¥æ­´ (Transaction Log) -->
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ğŸ“œ å–å¼•å±¥æ­´ (Transaction Log)</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç¨®åˆ¥ (Type)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ã‚«ãƒ†ã‚´ãƒª</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é‡‘é¡ (Amount)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å–å¼•å¾Œæ®‹é«˜</th>
                            </tr>
                        </thead>
                        <tbody id="transaction-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- å–å¼•å±¥æ­´ãŒå…¥ã‚‹ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- æ¶ˆè²»ãƒ»éæµå‹•æ€§è³‡ç”£ -->
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ğŸ æ¶ˆè²»ãƒ»éæµå‹•æ€§è³‡ç”£</h2>
                <div id="item-list" class="space-y-2">
                    <!-- ã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆãŒå…¥ã‚‹ -->
                </div>
            </div>
        </div>


        <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <footer class="mt-8 text-center text-sm text-gray-500 p-4">
            æœ€çµ‚æ›´æ–°: <span id="last-updated"></span> | ãƒ‡ãƒ¼ã‚¿æ§‹é€ : assets.json, transactions.json | ã‚»ãƒƒã‚·ãƒ§ãƒ³: <span id="session-number"></span>
        </footer>
    </div>

    <script>
        // Economic Data (æ—¥æœ¬èªè¡¨ç¤ºç”¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’å†å®šç¾©ã¾ãŸã¯èª¿æ•´)
        const data = {
            assets: {
                last_updated: "2025-10-29T15:00:00+09:00",
                session: 7,
                world_date: "2025-10-25",
                cash: { total_in_gold: 0.5, real_world_equivalent_jpy: 500000 },
                items: [
                    { name: "æœ¨å½«ã‚Šã®ãŠå®ˆã‚Š", count: 3, type: "sentimental", note: "sentimental_value: true" },
                    { name: "æ‘ã®é‡èœ", count: 1, type: "consumable", note: "10éŠ…è²¨" },
                    { name: "å¹²ã—è‚‰", count: 1, type: "consumable", note: "30éŠ…è²¨" },
                ],
                equipment: { weapons: ["æœ¨å‰£ (0.5éŠ€è²¨) x 3"], armor: [] },
                summary: { total_assets_gold: 0.54, total_assets_jpy: 540000, liquid_assets_gold: 0.5, net_worth_gold: 0.54 },
            },
            transactions: {
                total_income_gold: 0.5,
                total_expenses_gold: 0.1,
                net_gold: 0.4,
                transaction_count: 2,
                transactions: [
                    { id: 1, type: "income", category: "quest_reward", amount: "+50éŠ€è²¨ï¼ˆ+0.5é‡‘è²¨ï¼‰", balance_after: "0.5é‡‘è²¨" },
                    { id: 2, type: "expense", category: "furniture", amount: "-10éŠ€è²¨ï¼ˆ-0.1é‡‘è²¨ï¼‰", balance_after: "0.4é‡‘è²¨" },
                ],
            },
            analysis: {
                asset_breakdown: { cash_jpy: 500000, cash_pct: 92.6, equipment_jpy: 40000, equipment_pct: 7.4 },
                cash_flow: { income_gold: 0.5, expenses_gold: 0.1, net_profit_gold: 0.4, roi: "80%" },
                purchasing_power: [
                    { item: "ãƒ‘ãƒ³", count: "1000å€‹åˆ†" },
                    { item: "é£Ÿäº‹", count: "142å›åˆ†" },
                    { item: "æ‘ã®å®¿", count: "166æ³Šåˆ†" },
                    { item: "ç·´ç¿’ç”¨ã®å‰£", count: "25æœ¬åˆ†" },
                    { item: "å®Ÿæˆ¦ç”¨ã®å‰£", count: "5æœ¬åˆ†" },
                    { item: "é©é§", count: "10ç€åˆ†" },
                ],
                // NEW: æˆ¦ç•¥åˆ†æç”¨ã®ãƒ‡ãƒ¼ã‚¿
                strategic: {
                    daily_meal_gold: 0.5 / 142, // 1é£Ÿã‚ãŸã‚Šç´„0.0035é‡‘è²¨ã¨ä»®å®š
                    milestone_1_target: 5.0, // 5é‡‘è²¨
                    milestone_1_unlock: "ç•‘1æšè³¼å…¥å¯èƒ½ã«"
                }
            },
            investment_simulations: [
                { target: "ç•‘1æš", cost: "5-10 Gold", annual_return: "2-5 Gold", roi: "20-50%", notes: "é«˜ã„æˆé•·æ€§" },
                { target: "æ‘ã®å®¿1è»’", cost: "20-50 Gold", annual_return: "æœªå®š", roi: "æœªå®š", notes: "ä¸å‹•ç”£æŠ•è³‡ãƒ»é«˜é›£åº¦ã‚¯ã‚¨ã‚¹ãƒˆ" },
                { target: "æ‘ï¼ˆå°ï¼‰", cost: "260 Gold", annual_return: "18 Gold", roi: "6.9%", notes: "å®‰å®šåå…¥ãƒ»ä¸åœ¨åœ°ä¸»å‹" },
            ],
            milestones: [
                { target: "5 Gold (Â¥10M)", method: "10 quests (â˜…â˜… difficulty)", unlock: "Can purchase Farmland (1 Plot)" },
                { target: "50 Gold (Â¥100M)", method: "Real estate investment, High-difficulty quests", unlock: "Can purchase Village Inn (1 Unit)" },
                { target: "260 Gold (Â¥520M)", method: "Business expansion, Investment income", unlock: "Can purchase Small Village" },
            ],
        };

        // ãƒ­ãƒ¼ã‚«ãƒ«é€šè²¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•° (JPY)
        const formatJpy = (amount) => {
            return amount.toLocaleString('ja-JP', { style: 'currency', currency: 'JPY', maximumFractionDigits: 0 });
        };

        // 1. ä¸»è¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ãƒ¡ã‚¿æƒ…å ±ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        const currentGold = data.assets.summary.liquid_assets_gold;
        const consumptionDays = Math.floor(currentGold / data.analysis.strategic.daily_meal_gold); // ç¾é‡‘ã§ä½•æ—¥é£Ÿäº‹ãŒã§ãã‚‹ã‹
        const milestoneTarget = data.analysis.strategic.milestone_1_target;
        const progressPercentage = (data.assets.summary.net_worth_gold / milestoneTarget) * 100;


        document.getElementById('session-number').textContent = data.assets.session;
        document.getElementById('liquid-assets-gold').textContent = `${currentGold.toFixed(2)} é‡‘è²¨`;
        document.getElementById('net-worth-gold').textContent = `${data.assets.summary.net_worth_gold.toFixed(2)} é‡‘è²¨ (${formatJpy(data.assets.summary.total_assets_jpy)})`;
        document.getElementById('current-roi').textContent = data.analysis.cash_flow.roi;
        document.getElementById('last-updated').textContent = data.assets.last_updated;
        document.getElementById('consumption-days').textContent = `${consumptionDays} æ—¥`;
        
        document.getElementById('milestone-note').innerHTML = `
            æ¬¡ã®ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ (5 é‡‘è²¨) é”æˆã§ã€**${data.analysis.strategic.milestone_1_unlock}** ã§ãã¾ã™ã€‚ç¾åœ¨ã€<span class="font-bold text-lg text-indigo-600">${Math.min(100, progressPercentage).toFixed(1)}%</span> ã®é€²æ—ã§ã™ã€‚
        `;

        // 2. è³‡ç”£æ§‹æˆ å††ã‚°ãƒ©ãƒ• (Asset Breakdown Chart)
        const assetCtx = document.getElementById('assetBreakdownChart').getContext('2d');
        new Chart(assetCtx, {
            type: 'pie',
            data: {
                labels: [`æµå‹•è³‡ç”£: ç¾é‡‘ (${data.analysis.asset_breakdown.cash_pct}%)`, `éæµå‹•è³‡ç”£: è£…å‚™ (${data.analysis.asset_breakdown.equipment_pct}%)`],
                datasets: [{
                    data: [data.analysis.asset_breakdown.cash_pct, data.analysis.asset_breakdown.equipment_pct],
                    backgroundColor: ['#6366f1', '#f59e0b'], // Indigo and Amber
                    hoverOffset: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: { size: 14 }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.parsed;
                                // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—å†…ã‚‚æ—¥æœ¬èªã§è¡¨ç¤º
                                const jpyValue = value === data.analysis.asset_breakdown.cash_pct ? data.analysis.asset_breakdown.cash_jpy : data.analysis.asset_breakdown.equipment_jpy;
                                return `${label.split(':')[0].trim()}: ${formatJpy(jpyValue)}`;
                            }
                        }
                    }
                }
            }
        });
        document.getElementById('asset-breakdown-details').innerHTML = `
            <p><strong>ç·è³‡ç”£:</strong> ${formatJpy(data.assets.summary.total_assets_jpy)}</p>
            <p><strong>æµå‹•æ€§:</strong> <span class="text-green-600 font-bold">${data.analysis.asset_breakdown.cash_pct}%</span> - ç¾é‡‘æ¯”ç‡ãŒæ¥µã‚ã¦é«˜ã„ï¼ˆæŠ•è³‡æ©Ÿä¼šå¾…ã¡ï¼‰</p>
        `;


        // 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ æ£’ã‚°ãƒ©ãƒ• (Cash Flow Chart)
        const flowCtx = document.getElementById('cashFlowChart').getContext('2d');
        new Chart(flowCtx, {
            type: 'bar',
            data: {
                labels: ['åå…¥', 'æ”¯å‡º', 'ç´”åˆ©ç›Š'],
                datasets: [{
                    label: 'é‡‘è²¨',
                    data: [
                        data.transactions.total_income_gold,
                        -data.transactions.total_expenses_gold,
                        data.transactions.net_gold
                    ],
                    backgroundColor: [
                        '#10b981', // Emerald for Income
                        '#ef4444', // Red for Expense
                        '#3b82f6'  // Blue for Net
                    ],
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: 'é‡‘è²¨'
                        }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += new Intl.NumberFormat('ja-JP', { minimumFractionDigits: 2 }).format(context.parsed.y) + ' é‡‘è²¨';
                                return label;
                            }
                        }
                    }
                }
            }
        });

        // 4. NEW: ç›®æ¨™é”æˆé€²æ—ã‚°ãƒ©ãƒ•
        const progressCtx = document.getElementById('targetProgressChart').getContext('2d');
        new Chart(progressCtx, {
            type: 'bar',
            data: {
                labels: ['ç¾åœ¨ã®ç´”è³‡ç”£', 'ç›®æ¨™ã¾ã§å¿…è¦'],
                datasets: [{
                    label: 'ç´”è³‡ç”£ (é‡‘è²¨)',
                    data: [
                        data.assets.summary.net_worth_gold,
                        milestoneTarget - data.assets.summary.net_worth_gold 
                    ],
                    backgroundColor: [
                        '#10b981', // Emerald (é”æˆæ¸ˆã¿)
                        '#e5e7eb'  // Gray (æœªé”æˆ)
                    ],
                    borderRadius: 6
                }]
            },
            options: {
                indexAxis: 'y', // æ¨ªæ£’ã‚°ãƒ©ãƒ•
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true,
                        max: milestoneTarget,
                        title: { display: true, text: 'é‡‘è²¨ (Gold)' }
                    },
                    y: {
                        stacked: true,
                        display: false
                    }
                },
                plugins: {
                    legend: { display: false },
                    title: {
                        display: true,
                        text: `ç›®æ¨™: ${milestoneTarget} é‡‘è²¨`,
                        font: { size: 16 }
                    }
                }
            }
        });


        // 5. æŠ•è³‡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        const investmentBody = document.getElementById('investment-simulation-body');
        data.investment_simulations.forEach(i => {
            investmentBody.innerHTML += `
                <tr class="hover:bg-gray-50">
                    <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${i.target}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">${i.cost}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm text-green-600">${i.annual_return}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm font-bold text-red-600">${i.roi}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-xs text-gray-400">${i.notes}</td>
                </tr>
            `;
        });
        
        // 6. è³¼è²·åŠ›ãƒªã‚¹ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        const powerList = document.getElementById('purchasing-power-list');
        data.analysis.purchasing_power.forEach(p => {
            powerList.innerHTML += `
                <li class="flex justify-between items-center py-1 border-b border-dashed">
                    <span class="text-gray-700">${p.item}</span>
                    <span class="font-semibold text-indigo-600">${p.count}</span>
                </li>
            `;
        });

        // 7. ã‚¢ã‚¤ãƒ†ãƒ ã¨è£…å‚™ãƒªã‚¹ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        const itemList = document.getElementById('item-list');
        
        itemList.innerHTML += `<p class="font-bold text-sm mt-2 text-gray-700">æ¶ˆè²»ã‚¢ã‚¤ãƒ†ãƒ </p>`;
        data.assets.items.filter(i => i.type === 'consumable').forEach(i => {
            itemList.innerHTML += `
                <div class="text-sm ml-2 p-1 bg-yellow-50/50 rounded-md">
                    <span class="font-medium">ğŸ¥• ${i.name} Ã— ${i.count}</span>
                    <span class="text-xs text-gray-500 ml-2">(${i.note})</span>
                </div>
            `;
        });

        itemList.innerHTML += `<p class="font-bold text-sm mt-4 text-gray-700">è£…å‚™ (éæµå‹•æ€§è³‡ç”£)</p>`;
        data.assets.equipment.weapons.forEach(w => {
             itemList.innerHTML += `
                <div class="text-sm ml-2 p-1 bg-blue-50/50 rounded-md">
                    <span class="font-medium">âš”ï¸ ${w}</span>
                </div>
            `;
        });

        itemList.innerHTML += `<p class="font-bold text-sm mt-4 text-gray-700">ãã®ä»–ï¼ˆè¨˜å¿µå“ï¼‰</p>`;
        data.assets.items.filter(i => i.type === 'sentimental').forEach(i => {
             itemList.innerHTML += `
                <div class="text-sm ml-2 p-1 bg-pink-50/50 rounded-md">
                    <span class="font-medium">ğŸ’– ${i.name} Ã— ${i.count}</span>
                    <span class="text-xs text-gray-500 ml-2">(${i.note})</span>
                </div>
            `;
        });

        // 8. å–å¼•å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        const transactionBody = document.getElementById('transaction-table-body');
        data.transactions.transactions.forEach(t => {
            const amountColor = t.type === 'income' ? 'text-green-600 font-bold' : 'text-red-600 font-bold';
            const typeLabel = t.type === 'income' ? 'åå…¥' : 'æ”¯å‡º';
            const balanceAfterLabel = t.balance_after; // æ—¢ã«æ—¥æœ¬èª
            
            // é‡‘é¡ã®å˜ä½ã‚’æ—¥æœ¬èªã«æˆ»ã™
            let amountText = t.amount;
            if (t.amount.includes("Silver") || t.amount.includes("Gold")) {
                amountText = amountText.replace("Silver", "éŠ€è²¨").replace("Gold", "é‡‘è²¨").replace("(", "ï¼ˆ").replace(")", "ï¼‰");
            }

            transactionBody.innerHTML += `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${t.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${amountColor}">${typeLabel}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${t.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${amountColor}">${amountText}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${balanceAfterLabel}</td>
                </tr>
            `;
        });

    </script>
</body>
</html>
